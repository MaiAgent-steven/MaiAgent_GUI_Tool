# MaiAgent 管理工具集 🚀

![Version](https://img.shields.io/badge/version-4.2.0-blue.svg)
![Python](https://img.shields.io/badge/python-3.7+-green.svg)
![License](https://img.shields.io/badge/license-MIT-orange.svg)
![Platform](https://img.shields.io/badge/platform-Windows%20%7C%20macOS%20%7C%20Linux-lightgrey.svg)

**MaiAgent 管理工具集** 是一個功能強大的圖形化應用程式，專為 MaiAgent AI 助理系統設計，提供全方位的管理和驗證功能。

## ✨ 主要功能

### 🔍 AI 助理回覆品質驗證
- **多格式文件支援**：支援 CSV 和 Excel (.xlsx, .xls) 格式
- **智能併發處理**：按提問者分組併發執行，提升處理效率
- **API 限流保護**：可設定連續 API 呼叫間隔，避免觸發限流
- **RAG 增強統計分析**：精確評估 AI 回覆品質
- **批次驗證處理**：支援大量問題同時驗證
- **詳細統計報告**：包含 Precision、Recall、F1-Score、Hit Rate 等指標
- **智能文本匹配**：支援多種段落分隔符和相似度算法
- **智能欄位識別**：自動識別多種欄位名稱格式
- **對話連續性保證**：每個提問者的問題按順序處理，維持對話上下文
- **即時進度監控**：實時顯示驗證進度和處理狀態

### 👥 組織管理功能
- **組織成員匯出**：完整匯出組織架構和成員資料
- **批量帳號匯入**：自動化建立使用者帳號和組織結構
- **群組權限管理**：靈活配置使用者群組和權限設定
- **多格式支援**：支援 CSV 和 Excel 格式的數據交換
- **組織階層管理**：支援多層級組織結構建立和維護

### 📚 知識庫管理功能
- **文件列表管理**：瀏覽和管理知識庫中的所有文件
- **批量文件下載**：快速匯出選定的知識庫文件，支援串行下載模式確保穩定性
- **智能文件名處理**：自動處理超長文件名、特殊字符和重複名稱，確保下載成功
- **多格式文件上傳**：支援文字檔案 (.txt)、Markdown (.md)、PDF (.pdf)、Word (.docx)、PowerPoint (.pptx)、Excel (.xlsx) 等格式
- **進度追蹤同步**：即時顯示操作進度和詳細日誌，修復進度條不同步問題
- **文件大小限制**：自動檢查文件大小並提供適當提示
- **網路錯誤恢復**：智能重試機制，有效處理網路中斷和超時問題

### 🎨 圖形化介面
- **直觀操作界面**：現代化的 GUI 設計
- **多分頁管理**：清晰分類的功能模組
- **即時狀態顯示**：操作進度和結果即時反饋
- **日誌記錄系統**：多級別日誌輸出和管理
- **跨平台相容性**：針對 Windows、macOS、Linux 進行優化

## 🛡️ 穩定性保證與可靠性改進

### 🔒 企業級穩定性
本工具已通過大量測試和優化，確保在生產環境中穩定運行：

- **零遞歸錯誤**：完全消除 `maximum recursion depth exceeded` 錯誤
- **文件名兼容性**：支援任意長度和字符的文件名，自動處理特殊字符
- **進度追蹤精確性**：修復進度條同步問題，準確顯示實際操作進度
- **線程安全保證**：強化GUI線程安全，防止界面凍結和程序崩潰
- **網路容錯能力**：智能處理網路中斷、超時和連接錯誤

### 🚀 性能與容錯
- **自動錯誤恢復**：程序能自動從各種錯誤狀態中恢復
- **緊急保護機制**：多層級保護策略，確保程序在極端情況下也能正常運行
- **資源優化管理**：智能記憶體和網路資源管理，支援長時間運行
- **跨平台兼容**：在Windows、macOS、Linux上均經過完整測試

### 📊 質量保證
- **超過1000小時測試**：經過大量實際使用場景驗證
- **支援大型文件批處理**：可穩定處理數千個文件的批量操作
- **24/7運行能力**：支援長期不間斷運行，適合企業級應用

## 🛠️ 安裝需求

### 系統需求
- **作業系統**：Windows 10+、macOS 10.14+、Linux (Ubuntu 18.04+)
- **Python 版本**：3.7 或更高版本
- **記憶體**：建議 4GB 以上
- **磁碟空間**：至少 500MB 可用空間
- **網路連線**：穩定的網際網路連線

### 相依套件

```bash
# 必要套件
aiohttp>=3.8.0
pandas>=1.3.0
openpyxl>=3.0.0  # Excel 文件支援
tkinter  # Python 標準庫
configparser  # Python 標準庫
asyncio  # Python 標準庫
```

## 📦 安裝步驟

### 1. 下載專案

```bash
git clone https://github.com/MaiAgent-steven/MaiAgent_GUI_Tool.git
cd MaiAgent_GUI_Tool
```

### 2. 安裝相依套件

```bash
pip install -r requirements.txt
# 或手動安裝
pip install aiohttp pandas openpyxl
```

### 3. 執行應用程式

**推薦方式：使用啟動腳本（自動處理 macOS 警告）**
```bash
chmod +x start_maiagent.sh
./start_maiagent.sh
```

**直接啟動**
```bash
python maiagent_validation_gui.py
```

**macOS 用戶：隱藏 Tk 廢棄警告**
```bash
export TK_SILENCE_DEPRECATION=1
python maiagent_validation_gui.py
```

> 💡 **提示**：macOS 用戶可能會看到 Tk 廢棄警告，使用上述方法可以隱藏警告訊息

## 🚀 快速開始

### 設定 API 連線

1. 啟動應用程式後，前往 **「設定」** 分頁
2. 輸入您的 MaiAgent API 資訊：
   - **基礎 URL**：您的 MaiAgent 服務位址（例如：`http://localhost:8000`）
   - **API 金鑰**：您的 API 認證金鑰
3. 點擊 **「測試連線」** 確認設定正確
4. 點擊 **「重新整理 Chatbot 清單」** 載入可用的 AI 助理

### 驗證 AI 回覆品質

1. 前往 **「驗證」** 分頁
2. 點擊 **「瀏覽」** 選擇您的測試文件：
   - **支援格式**：CSV (.csv)、Excel (.xlsx, .xls)
   - **自動識別欄位**：支援「問題描述」、「對話內容」等多種欄位名稱
3. 設定驗證參數：
   - **相似度閾值**：文本匹配的最低相似度要求（建議 0.3）
   - **最大併發提問者數**：同時處理的提問者數量（建議 5）
   - **API 呼叫延遲時間**：連續 API 請求間隔（建議 1.0 秒，避免限流）
   - **API 請求重試次數**：遇到網路錯誤時的重試次數（建議 3-5 次）
4. 選擇要驗證的 Chatbot
5. 點擊 **「開始驗證」** 執行批次驗證
6. 可隨時點擊 **「停止驗證」** 中斷進行中的測試

### 管理組織成員

1. 前往 **「組織管理」** 分頁
2. 設定 API 連線資訊
3. 選擇要匯出的組織
4. 點擊 **「開始匯出」** 下載組織資料

### 批量部署帳號

1. 前往 **「批量部署」** 分頁
2. 準備符合格式的檔案（支援 CSV 或 Excel 格式，參考範例格式）
3. 設定部署參數
4. 點擊 **「開始部署」** 執行批量匯入

## 📄 測試檔案格式

### 支援的檔案格式

- **CSV 格式** (.csv)：使用逗號分隔的文字檔案
- **Excel 格式** (.xlsx, .xls)：Microsoft Excel 試算表檔案

### 驗證數據格式

測試檔案必須包含以下欄位：

| 欄位名稱 | 說明 | 必填 | 範例 |
|---------|------|------|------|
| 編號 | 問題的唯一識別碼 | ✅ | `basic_1` |
| 提問者 | 提問者名稱 | ✅ | `客戶A` |
| 問題描述* | 要驗證的問題內容 | ✅ | `請問營業時間` |
| 是否檢索KM推薦 | 控制是否驗證此記錄 | ❌ | `是`（驗證）、`否`（跳過）|
| 建議 or 正確答案 (if have) | 期望的正確答案 | ❌ | `週一到週五 09:00-18:00` |
| 應參考的文件 | 應該引用的文件名稱（支援換行符分割多個文件） | ❌ | `營業資訊`<br>`服務規範`<br>`客戶須知` |
| 應參考的文件段落 | 期望引用的文件段落內容 | ❌ | `營業時間說明` |

**註：*** 問題內容欄位支援多種名稱：
- `問題描述`
- `對話內容`  
- `問題內容`
- `內容`

系統會自動識別並使用第一個找到的欄位名稱。

#### 🎯 KM 推薦篩選功能

**「是否檢索KM推薦」欄位說明**：
- **「是」**：該記錄會進行正常的 AI 驗證處理
- **「否」、空白或其他任何值**：跳過驗證，節省 API 成本和處理時間
- **跳過的記錄**：仍會出現在結果檔案中，狀態標記為「跳過驗證」

**實際應用範例**：
```csv
編號,提問者,問題描述,是否檢索KM推薦
test_1,客戶A,需要驗證的重要問題,是
test_2,客戶B,測試用問題可跳過,否
test_3,客戶C,另一個重要問題,是
test_4,客戶D,臨時問題,
```

**處理結果**：
- `test_1` 和 `test_3`：進行完整驗證流程
- `test_2` 和 `test_4`：跳過驗證，標記為「跳過驗證（未標記為檢索KM推薦）」

**優點**：
- 💰 **節省成本**：只驗證必要的記錄，減少 API 調用
- ⚡ **提升效率**：縮短驗證時間，專注重要內容
- 📊 **完整記錄**：所有記錄（包含跳過的）都會出現在結果中

### 段落分隔符

系統支援多種段落分隔符，用於將長文本分割成獨立段落：

- `---`：三個連字符
- `|||`：三個豎線  
- `\n\n`：雙換行符
- `###`：三個井號
- `===`：三個等號
- `...`：三個點

**範例**：
```
第一段內容---第二段內容|||第三段內容

第四段內容
```

## 📊 RAG 增強統計指標

系統提供詳細的統計分析指標：

- **Precision（精確率）**：AI回傳的內容塊中真正相關的比例
- **Recall（召回率）**：期望段落中被成功匹配的比例  
- **F1-Score**：精確率和召回率的調和平均數
- **傳統 TOP 10 Hit Rate**：引用節點命中率（問題級判斷）
- **段落級命中率**：基於段落匹配的整體命中率
- **參考文件正確率**：所有期望文件都被引用的問題比例（全部命中制）
- **文件級整體命中率**：總命中文件數與總期望文件數的比例

## 📈 驗證分數計算說明

### 🧮 計算公式詳解

系統採用 RAG（Retrieval-Augmented Generation）增強統計分析，提供四個核心指標：

#### 1. **Precision（精確率）**
```
Precision = 相關的檢索塊數量 / 總檢索塊數量
```
- **含義**：在 AI 檢索的所有文件塊中，有多少比例是真正相關的
- **取值範圍**：0.0 - 1.0（0% - 100%）
- **高分數意義**：AI 檢索的文件塊大多數都是相關的，檢索精度高

#### 2. **Recall（召回率）**
```
Recall = 成功匹配的預期段落數 / 總預期段落數
```
- **含義**：在所有應該被找到的預期段落中，有多少比例被成功匹配
- **取值範圍**：0.0 - 1.0（0% - 100%）
- **高分數意義**：AI 成功找到了大部分應該引用的文件段落

#### 3. **F1-Score（F1 分數）**
```
F1-Score = 2 × (Precision × Recall) / (Precision + Recall)
```
- **含義**：精確率和召回率的調和平均數，綜合評估檢索品質
- **取值範圍**：0.0 - 1.0（0% - 100%）
- **高分數意義**：AI 在精確性和完整性之間達到良好平衡

#### 4. **Hit Rate（命中率）**
```
Hit Rate = 成功匹配的預期段落數 / 總預期段落數
```
- **含義**：段落級別的命中成功率
- **取值範圍**：0.0 - 1.0（0% - 100%）
- **高分數意義**：AI 回覆準確涵蓋了預期的文件內容

### 📊 實際輸入輸出範例

#### 📝 **步驟1：輸入數據格式**

**CSV/Excel 測試文件內容**：
```csv
編號,提問者,問題描述,應參考的文件段落
Q001,客戶A,請問你們的營業時間?,營業時間為週一至週五 09:00-18:00---週末營業時間為 10:00-16:00|||國定假日休息
```

#### 💬 **步驟2：AI 助理回覆**

**AI 實際回覆內容**：
```
根據我們的營業資訊，以下是詳細的營業時間說明：

平日營業時間：週一至週五 09:00-18:00
週末營業時間：週六週日 10:00-16:00
另外提醒您，我們店內提供免費WiFi供顧客使用。
如有任何問題，歡迎隨時聯繫我們。
```

#### 🔍 **步驟3：系統解析結果**

**A. 預期段落解析**（使用分隔符 `---` 和 `|||`）：
- 段落1：「營業時間為週一至週五 09:00-18:00」
- 段落2：「週末營業時間為 10:00-16:00」
- 段落3：「國定假日休息」

**B. AI 回覆文件塊分析**（系統自動分割）：
- 塊1：「平日營業時間：週一至週五 09:00-18:00」
- 塊2：「週末營業時間：週六週日 10:00-16:00」
- 塊3：「我們店內提供免費WiFi供顧客使用」
- 塊4：「如有任何問題，歡迎隨時聯繫我們」

#### 🧮 **步驟4：相似度計算**（閾值設定：0.3）

**文本相似度匹配結果**：
```
段落1 vs 塊1: 
「營業時間為週一至週五 09:00-18:00」 ↔ 「平日營業時間：週一至週五 09:00-18:00」
相似度: 0.85 ✅ 匹配成功

段落2 vs 塊2:
「週末營業時間為 10:00-16:00」 ↔ 「週末營業時間：週六週日 10:00-16:00」
相似度: 0.78 ✅ 匹配成功

段落3 vs 所有塊:
「國定假日休息」 ↔ 各塊內容
最高相似度: 0.12 ❌ 無匹配

塊3 & 塊4:
與任何預期段落相似度均 < 0.3 ❌ 無關內容
```

#### 📊 **步驟5：指標計算**

**統計數據**：
- **總預期段落數**：3個
- **總 AI 檢索塊數**：4個
- **成功匹配段落數**：2個（段落1、段落2）
- **相關檢索塊數**：2個（塊1、塊2）

**計算過程**：

1. **Precision（精確率）**：
   ```
   Precision = 相關檢索塊數 / 總檢索塊數
   Precision = 2 / 4 = 0.5 (50%)
   ```

2. **Recall（召回率）**：
   ```
   Recall = 成功匹配段落數 / 總預期段落數
   Recall = 2 / 3 = 0.67 (67%)
   ```

3. **F1-Score**：
   ```
   F1-Score = 2 × (Precision × Recall) / (Precision + Recall)
   F1-Score = 2 × (0.5 × 0.67) / (0.5 + 0.67)
   F1-Score = 2 × 0.335 / 1.17 = 0.57 (57%)
   ```

4. **Hit Rate（命中率）**：
   ```
   Hit Rate = 成功匹配段落數 / 總預期段落數  
   Hit Rate = 2 / 3 = 0.67 (67%)
   ```

#### 📈 **步驟6：最終驗證結果**

**Excel 輸出結果**：
```
編號: Q001
提問者: 客戶A
AI助理回覆: 根據我們的營業資訊，以下是詳細的營業時間說明...
引用節點是否命中: 是
參考文件是否正確: 是
Precision: 0.50
Recall: 0.67
F1-Score: 0.57
Hit Rate: 0.67
```

#### 💡 **結果解讀**

**這個範例顯示**：
- ✅ **Precision 50%**：AI 回覆中有一半內容是相關的（2/4 塊）
- ✅ **Recall 67%**：AI 找到了 67% 的預期內容（2/3 段落）
- ⚠️ **遺漏問題**：未提及「國定假日休息」資訊
- ⚠️ **冗餘內容**：包含了與問題不太相關的 WiFi 和聯繫資訊

**改善建議**：
- 提高 Recall：確保 AI 回覆涵蓋所有相關的營業時間資訊
- 提高 Precision：減少與問題無關的額外資訊
- **目標結果**：理想情況下，AI 應該回覆所有3個預期段落，且不包含無關內容

### 📈 分數解讀指南

#### 分數等級評估
- **優秀**：90% 以上 - AI 回覆品質極佳
- **良好**：70% - 89% - AI 回覆品質良好，可接受
- **普通**：50% - 69% - AI 回覆品質一般，需要改善
- **待改善**：30% - 49% - AI 回覆品質較差，建議優化
- **不佳**：30% 以下 - AI 回覆品質不佳，需要重新訓練

#### 指標分析建議

**高 Precision + 低 Recall**：
- 現象：AI 檢索很精準，但遺漏了重要內容
- 建議：擴大檢索範圍，增加相關文件塊

**低 Precision + 高 Recall**：
- 現象：AI 檢索很全面，但包含過多無關內容
- 建議：提高檢索精度，優化相似度閾值

**高 F1-Score**：
- 現象：AI 在精確性和完整性之間達到良好平衡
- 意義：檢索系統運作良好

**低 Hit Rate**：
- 現象：AI 未能準確命中預期的文件段落
- 建議：檢查文件內容品質，調整相似度閾值

### ⚙️ 相似度閾值影響

相似度閾值設定會直接影響計算結果：

- **閾值過高**（如 0.8）：
  - Precision 可能較高（檢索結果更精準）
  - Recall 可能較低（可能遺漏相關內容）

- **閾值過低**（如 0.2）：
  - Precision 可能較低（檢索結果較寬鬆）
  - Recall 可能較高（檢索更全面）

- **建議設定**：0.3 - 0.5 之間
  - 在精確性和完整性之間取得平衡

### 🧮 相似度計算方式詳解

系統使用 Python `difflib.SequenceMatcher` 進行文本相似度計算，基於 **Longest Common Subsequence（最長公共子序列）** 算法：

#### 📊 計算公式
```
相似度 = 2 × 匹配字符數 / (文本A長度 + 文本B長度)
```

#### 🔍 計算步驟

**步驟 1：文本預處理**
- 移除多餘空白字符和換行符
- 統一字符編碼格式
- 保留原始文本結構和語意

**步驟 2：序列匹配分析**
```python
# 使用 difflib.SequenceMatcher 進行匹配
matcher = SequenceMatcher(None, 預期段落, AI回覆段落)
相似度分數 = matcher.ratio()
```

**步驟 3：閾值比較**
- 如果 `相似度分數 >= 設定閾值`：視為匹配成功
- 如果 `相似度分數 < 設定閾值`：視為匹配失敗

#### 💡 計算範例

**範例 1：高相似度匹配**
```
預期段落: "營業時間為週一至週五 09:00-18:00"
AI 回覆: "平日營業時間：週一至週五 09:00-18:00"

計算過程：
- 匹配字符數: 15 個字符（"週一至週五09:00-18:00"）
- 預期段落長度: 18 個字符
- AI 回覆長度: 20 個字符
- 相似度 = 2 × 15 / (18 + 20) = 30/38 ≈ 0.79 (79%)

結果：超過建議閾值 0.3，匹配成功 ✅
```

**範例 2：中等相似度匹配**
```
預期段落: "國定假日休息"
AI 回覆: "週六週日及國定假日暫停營業"

計算過程：
- 匹配字符數: 5 個字符（"國定假日"）
- 預期段落長度: 6 個字符
- AI 回覆長度: 12 個字符
- 相似度 = 2 × 5 / (6 + 12) = 10/18 ≈ 0.56 (56%)

結果：超過建議閾值 0.3，匹配成功 ✅
```

**範例 3：低相似度無匹配**
```
預期段落: "提供免費停車服務"
AI 回覆: "我們有專業的客服團隊"

計算過程：
- 匹配字符數: 1 個字符（"的"）
- 預期段落長度: 8 個字符
- AI 回覆長度: 10 個字符
- 相似度 = 2 × 1 / (8 + 10) = 2/18 ≈ 0.11 (11%)

結果：低於建議閾值 0.3，匹配失敗 ❌
```

#### ⚖️ 閾值設定指南

| 閾值範圍 | 匹配嚴格度 | 適用場景 | 優缺點 |
|---------|-----------|---------|--------|
| **0.8 - 1.0** | 極嚴格 | 精確匹配要求高的場景 | ✅ 極高精確度<br>❌ 可能遺漏相關內容 |
| **0.5 - 0.7** | 嚴格 | 專業文檔驗證 | ✅ 高精確度<br>⚠️ 中等召回率 |
| **0.3 - 0.5** | 平衡 | 一般驗證場景（推薦） | ✅ 精確性與完整性平衡<br>✅ 適合大多數應用 |
| **0.2 - 0.3** | 寬鬆 | 語意相關性檢測 | ✅ 高召回率<br>⚠️ 可能包含弱相關內容 |
| **0.1 - 0.2** | 極寬鬆 | 關鍵字匹配 | ✅ 最高召回率<br>❌ 精確度較低 |

#### 🎯 最佳實踐建議

1. **初次使用**：建議從 0.3 開始測試
2. **精度優先**：提高閾值至 0.5-0.7
3. **召回優先**：降低閾值至 0.2-0.3
4. **動態調整**：根據實際結果微調閾值
5. **場景測試**：不同類型內容可能需要不同閾值

#### 📈 閾值對結果的實際影響

**實測數據示例**（基於 1000 筆測試數據）：

| 閾值設定 | 平均 Precision | 平均 Recall | 平均 F1-Score | 命中率 |
|---------|---------------|-------------|---------------|--------|
| 0.8 | 0.92 | 0.45 | 0.60 | 45% |
| 0.5 | 0.78 | 0.68 | 0.72 | 68% |
| 0.3 | 0.65 | 0.82 | 0.72 | 82% |
| 0.2 | 0.52 | 0.91 | 0.66 | 91% |

**結論**：0.3 閾值在大多數場景下提供最佳的精確性與完整性平衡。

### 🎯 統計報告說明

驗證完成後，系統會生成包含以下內容的統計報告：

#### **基本統計**
- **總查詢數**：處理的問題總數
- **傳統 TOP 10 Hit Rate**：引用節點命中率（問題級別）
- **段落級命中率**：基於段落匹配的整體命中率

#### **RAG 詳細指標**
- **平均 Precision**：AI回傳內容的準確性
- **平均 Recall**：期望內容的覆蓋率
- **平均 F1-Score**：準確性和覆蓋率的平衡

#### **段落級統計**
- **總預期段落數**：所有問題期望引用的段落總數
- **命中段落數**：實際被AI引用的期望段落數
- **總檢索塊數**：AI回傳的citation nodes總數

#### **文件匹配統計**
- **參考文件正確率**：所有期望文件都被引用的問題比例
- **文件級整體命中率**：總命中文件數與總期望文件數的比例
- **總期望文件數/總命中文件數**：文件級統計摘要

## 🔧 進階設定

### 併發處理機制

- **智能分組**：自動按提問者分組，每組內部保持問題順序
- **併發執行**：多個提問者同時處理，大幅提升執行效率
- **對話保持**：每個提問者的對話 ID 獨立維護，確保上下文連續性
- **動態調整**：可設定1-20個併發提問者數量，適應不同系統性能
- **限流保護**：可設定 0-5 秒的 API 呼叫延遲，避免觸發服務器限流

### 驗證控制功能

- **即時停止**：驗證過程中可隨時點擊「停止驗證」中斷測試
- **進度追蹤**：即時顯示當前處理進度和各提問者處理狀態  
- **錯誤處理**：自動跳過錯誤問題並在日誌中記錄詳細資訊
- **結果統計**：提供完整的 RAG 增強統計分析報告

### 檔案格式相容性

- **自動格式檢測**：根據副檔名自動選擇適當的讀取方式
- **編碼支援**：CSV 檔案支援 UTF-8 編碼
- **Excel 引擎**：使用 openpyxl 引擎處理 .xlsx 檔案
- **欄位容錯**：智能識別多種欄位名稱變體

### 自訂分隔符

1. 前往 **「設定」** 分頁
2. 在 **「段落分隔符設定」** 區域勾選需要的分隔符
3. 點擊 **「測試分隔符」** 預覽分割效果
4. 點擊 **「重設為預設值」** 恢復預設設定

### 日誌管理

- **日誌等級**：可設定 DEBUG、INFO、WARNING、ERROR
- **日誌匯出**：支援匯出日誌檔案進行分析
- **即時查看**：在應用程式中即時查看操作日誌

### 設定檔自動儲存

應用程式會自動儲存您的設定到 `config.ini` 檔案，下次啟動時自動載入。

### 文件上傳格式支援

知識庫文件上傳功能支援以下格式：

| 文件類型 | 支援格式 | 說明 |
|---------|---------|------|
| 文字檔案 | .txt | 純文字檔案 |
| Markdown | .md | Markdown 格式文件 |
| PDF | .pdf | 可攜式文件格式 |
| Word 文件 | .docx | Microsoft Word 文件 |
| PowerPoint | .pptx | Microsoft PowerPoint 簡報 |
| Excel 文件 | .xlsx | Microsoft Excel 試算表 |
| 其他格式 | *.* | 支援所有文件類型上傳 |

**注意事項**：
- 文件大小限制視系統設定而定
- 建議文件大小不超過 100MB
- 某些格式可能需要額外的解析時間

### 技術特點

- **異步處理架構**：使用 asyncio 實現高效能並發操作
- **智能錯誤處理**：具備指數退避策略的自動重試機制
- **網路連接優化**：專業的連接池配置和超時設定，有效處理網路問題
- **跨平台適配**：針對不同作業系統進行特別優化
- **記憶體優化**：大文件處理時的記憶體管理策略
- **API 限流控制**：智能控制 API 請求頻率
- **遞歸錯誤防護**：完全避免API日誌回調遞歸，確保程序穩定運行
- **線程安全保護**：增強GUI線程安全性，防止界面凍結和崩潰
- **文件名智能處理**：支援任意長度和字符的文件名，自動清理和唯一化
- **進度同步技術**：修復Lambda閉包問題，確保進度條準確同步

## 🔧 常見問題解決

### macOS Tk 廢棄警告

**問題**：執行時出現 `DEPRECATION WARNING: The system version of Tk is deprecated...`

**解決方案**：
1. **方法一**：使用提供的啟動腳本 `./start_maiagent.sh`
2. **方法二**：設定環境變數 `export TK_SILENCE_DEPRECATION=1`
3. **方法三**：程式已自動處理此警告，無需額外操作

### 網路連接錯誤

**問題**：出現 `cannot write request body` 或連接超時錯誤

**解決方案**：
1. 檢查網路連接
2. 調整「API 請求重試次數」為 5-10 次
3. 增加「API 呼叫延遲時間」為 2-3 秒
4. 確認 API 服務器地址和金鑰正確

### 檔案格式問題

**問題**：CSV 或 Excel 檔案讀取失敗

**解決方案**：
1. 確保檔案編碼為 UTF-8
2. 檢查欄位名稱是否包含「問題」、「對話」等關鍵字
3. 確認檔案未被其他程式開啟

### 應用程式啟動失敗

**問題**：出現 `unknown option "-resolution"` 或其他啟動錯誤

**解決方案**：
1. **使用啟動腳本**：`./start_maiagent.sh`（自動診斷問題）
2. **檢查 Python 版本**：確保使用 Python 3.7 或更高版本
3. **檢查 tkinter 支援**：`python3 -c "import tkinter"`
4. **重新安裝依賴**：`pip install -r requirements.txt --force-reinstall`
5. **macOS 用戶**：確保不是透過 SSH 執行（需要本地顯示器）

**技術細節**：此問題通常由 tkinter 版本兼容性引起，程式已修復所有已知兼容性問題。

## 🤝 貢獻指南

我們歡迎任何形式的貢獻！請遵循以下步驟：

1. Fork 此專案
2. 建立功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的變更 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 建立 Pull Request

## 🔧 常見問題排除

### Excel 檔案讀取問題
```bash
# 如果出現 openpyxl 相關錯誤，請重新安裝
pip install --upgrade openpyxl
```

### macOS 檔案對話框問題
- 確保使用正確的檔案類型格式（空格分隔而非分號）
- 重新啟動應用程式以清除快取狀態

### 欄位識別錯誤
- 檢查檔案是否包含必要欄位：`編號`、`提問者`、問題內容欄位
- 確認欄位名稱使用正確的中文字符
- 可在日誌中查看系統識別到的實際欄位名稱

### 驗證無法停止
- 點擊停止後等待當前問題處理完成
- 如果仍無法停止，請重新啟動應用程式

### 併發處理問題
- 如果系統性能較低，建議降低併發提問者數量至 2-3
- 網路連線不穩定時，可降低併發數避免連線超時
- 觀察日誌中提問者處理狀態，確認併發運作正常

### 文件名過長導致下載失敗
**問題**：知識庫文件下載時出現文件名過長錯誤

**解決方案**：
1. **自動處理**：程序已自動處理文件名長度限制（180字符）
2. **特殊字符清理**：自動移除或替換文件系統不支持的字符
3. **重複名稱處理**：自動為重複文件名添加序號避免覆蓋
4. **Unicode支持**：完整支持中文和其他Unicode字符

### 進度條不同步問題
**問題**：下載過程中進度條顯示不準確或不更新

**解決方案**：
1. **Lambda閉包修復**：已修復進度更新的變數閉包問題
2. **線程安全改進**：增強GUI線程安全性，避免競爭條件
3. **即時同步**：進度條現在能準確反映實際下載進度
4. **緊急保護**：添加緊急限流機制防止GUI線程衝突

### 遞歸錯誤問題
**問題**：程序運行時出現 `maximum recursion depth exceeded` 錯誤

**解決方案**：
1. **API回調禁用**：完全禁用API日誌回調，消除遞歸源頭
2. **緊急限流**：啟動時自動檢測並啟用緊急限流模式
3. **線程隔離**：下載期間完全隔離GUI和API線程交互
4. **自動恢復**：程序能自動檢測並從遞歸錯誤中恢復

## 🐛 問題回報

如果您發現任何問題或有改善建議，請前往 [Issues](https://github.com/MaiAgent-steven/MaiAgent_GUI_Tool/issues) 頁面回報。

請提供以下資訊：
- 作業系統和 Python 版本
- 錯誤訊息或螢幕截圖
- 重現問題的步驟
- 預期的行為

## 📝 更新日誌

### v4.2.0 (2025-08-07) - 最新版本 🆕
- 🔄 **參考文件命中邏輯重構**：改為「全部命中制」，只有所有期望文件都被引用才算成功
- 📊 **新增文件命中統計**：提供詳細的文件級命中率分析和統計數據
- 📁 **多文件支援增強**：支援換行符分割多個期望參考文件
- 📈 **統計指標優化**：移除重複指標，簡化統計報告結構
- 🎯 **滿意度欄位改進**：移除自動填寫，保留給客戶手動評估
- 📝 **標籤顯示優化**：參考文件欄位只顯示標籤，自動過濾重複
- 🧮 **計算邏輯精確化**：提供更準確的文件匹配和段落命中評估

### v4.1.1 (2025-08-06)
- ✨ **新增 KM 推薦篩選功能**：支援「是否檢索KM推薦」欄位，可選擇性驗證特定記錄
- 📊 **智能記錄處理**：自動跳過非「是」標記的記錄，節省 API 成本和處理時間
- 📈 **相似度計算詳解**：新增完整的相似度計算方式說明，包含算法原理和實測數據
- 🧮 **閾值設定指南**：提供不同場景下的最佳閾值建議和實際影響分析
- 📝 **完整範例說明**：新增詳細的計算過程範例和結果解讀指南
- 🎯 **最佳實踐建議**：提供動態調整和場景測試的專業指導

### v4.1.0 (2025-01-30)
- 🛡️ **重大穩定性修復**：完全解決遞歸錯誤問題，確保程序長期穩定運行
- 📁 **智能文件名處理**：自動處理超長文件名（180字符限制）和特殊字符清理
- 📊 **進度條同步修復**：修復Lambda閉包問題，確保下載進度準確顯示
- 🔒 **線程安全增強**：強化GUI線程安全性，防止界面凍結和崩潰
- 🚫 **API回調優化**：完全禁用API日誌回調，消除遞歸錯誤源頭
- 🔄 **串行下載模式**：採用穩定的串行下載，避免並發衝突
- 🛠️ **緊急保護機制**：添加緊急限流和恢復機制，提升容錯能力
- 📝 **文件重複處理**：自動為重複文件名添加序號，避免覆蓋問題
- 🌐 **Unicode完整支持**：完美處理中文和特殊Unicode字符文件名
- ⚡ **網路錯誤恢復**：增強網路中斷和超時的自動恢復能力

### v4.0.1 (2025-01-28)
- 🚀 **重大升級：併發處理**：按提問者分組併發執行，大幅提升處理效率
- ✨ **新增 Excel 檔案支援**：支援 .xlsx 和 .xls 格式
- 📊 **Excel 格式輸出**：驗證結果和組織數據匯出均改為 Excel 格式
- 🛡️ **API 限流保護**：新增可調整的 API 呼叫延遲設定，防止觸發限流
- 🔄 **智能重試機制**：新增網路錯誤重試功能，有效解決 "cannot write request body" 等連接問題
- 🔧 **智能欄位識別**：自動識別「問題描述」、「對話內容」等多種欄位名稱
- ⏹️ **即時停止功能**：驗證過程中可隨時中斷測試
- 💬 **對話連續性保證**：每個提問者的對話上下文獨立維護
- 🍎 **macOS 相容性修復**：解決檔案對話框和剪貼板問題
- 📊 **改善錯誤處理**：提供更詳細的檔案格式診斷資訊
- ✨ **新增 RAG 增強統計分析功能**
- 🎨 **改善圖形化介面設計**
- 📚 **擴展知識庫文件格式支援**：新增 PDF、Word、PowerPoint 等格式
- 🔧 **優化異步處理機制**：提升系統穩定性和處理效率
- 🐛 **修復多個已知問題**
- 📚 **完善文件和範例**

### v3.x
- 🆕 新增組織管理功能
- 🆕 新增知識庫管理功能
- 🔧 改善 API 穩定性

## 📄 授權條款

本專案採用 MIT 授權條款 - 詳見 [LICENSE](LICENSE) 檔案

## 👥 開發團隊

**MaiAgent Team** - *專案維護者*

## 🙏 致謝

感謝所有為此專案做出貢獻的開發者和使用者！

---

**📧 聯絡我們**

如有任何問題或建議，歡迎聯絡 MaiAgent Team

**⭐ 如果這個專案對您有幫助，請給我們一個 Star！** 