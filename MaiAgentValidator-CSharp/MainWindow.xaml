<Window x:Class="MaiAgentValidator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}"
        Title="MaiAgent 管理工具集 v4.2.6 - RAG 增強版" 
        Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Icon="maiagent.ico">

    <Grid>
        <TabControl Name="MainTabControl" Margin="10">
            <!-- 設定頁面 -->
            <TabItem Header="🔧 設定">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="20">
                        <!-- API 設定 -->
                        <materialDesign:Card Margin="0,0,0,20" Padding="20">
                            <StackPanel>
                                <TextBlock Text="API 設定" 
                                          Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                          Margin="0,0,0,15"/>
                                
                                <TextBlock Text="API 基礎 URL：" Margin="0,0,0,5"/>
                                <TextBox Name="ApiBaseUrlTextBox" 
                                        Text="http://localhost:8000"
                                        materialDesign:HintAssist.Hint="請輸入 MaiAgent API 基礎 URL"
                                        Margin="0,0,0,15"/>
                                
                                <TextBlock Text="API 金鑰：" Margin="0,0,0,5"/>
                                <PasswordBox Name="ApiKeyPasswordBox"
                                           materialDesign:HintAssist.Hint="請輸入 API 金鑰"
                                           Margin="0,0,0,15"/>
                                
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                                    <Button Name="TestConnectionButton" 
                                           Content="測試連接" 
                                           Click="TestConnectionButton_Click"
                                           Style="{StaticResource MaterialDesignRaisedButton}"
                                           Margin="0,0,10,0"/>
                                    <Button Name="RefreshChatbotsButton" 
                                           Content="重新載入機器人列表" 
                                           Click="RefreshChatbotsButton_Click"
                                           Style="{StaticResource MaterialDesignOutlinedButton}"/>
                                </StackPanel>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- 驗證參數 -->
                        <materialDesign:Card Margin="0,0,0,20" Padding="20">
                            <StackPanel>
                                <TextBlock Text="驗證參數" 
                                          Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                          Margin="0,0,0,15"/>
                                
                                <TextBlock Text="相似度閾值：" Margin="0,0,0,5"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Name="SimilarityThresholdSlider" 
                                           Grid.Column="0"
                                           Minimum="0.1" Maximum="1.0" Value="0.3" 
                                           TickFrequency="0.1" IsSnapToTickEnabled="True"
                                           ValueChanged="SimilarityThresholdSlider_ValueChanged"/>
                                    <TextBlock Name="SimilarityThresholdLabel" 
                                              Grid.Column="1"
                                              Text="0.30" 
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"/>
                                </Grid>
                                <TextBlock Text="建議值：0.3（平衡精確性與完整性）" 
                                          Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                          Foreground="Gray" Margin="0,5,0,15"/>
                                
                                <TextBlock Text="最大併發提問者數：" Margin="0,0,0,5"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Name="MaxConcurrentSlider" 
                                           Grid.Column="0"
                                           Minimum="1" Maximum="20" Value="5" 
                                           TickFrequency="1" IsSnapToTickEnabled="True"
                                           ValueChanged="MaxConcurrentSlider_ValueChanged"/>
                                    <TextBlock Name="MaxConcurrentLabel" 
                                              Grid.Column="1"
                                              Text="5" 
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"/>
                                </Grid>
                                <TextBlock Text="同時處理的提問者數量，建議 5" 
                                          Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                          Foreground="Gray" Margin="0,5,0,15"/>
                                
                                <TextBlock Text="API 呼叫延遲時間（秒）：" Margin="0,0,0,5"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Name="ApiDelaySlider" 
                                           Grid.Column="0"
                                           Minimum="0" Maximum="5" Value="1.0" 
                                           TickFrequency="0.5" IsSnapToTickEnabled="True"
                                           ValueChanged="ApiDelaySlider_ValueChanged"/>
                                    <TextBlock Name="ApiDelayLabel" 
                                              Grid.Column="1"
                                              Text="1.0" 
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"/>
                                </Grid>
                                <TextBlock Text="連續 API 請求間隔，避免觸發限流" 
                                          Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                          Foreground="Gray" Margin="0,5,0,15"/>
                                
                                <TextBlock Text="API 請求重試次數：" Margin="0,0,0,5"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider Name="MaxRetriesSlider" 
                                           Grid.Column="0"
                                           Minimum="1" Maximum="10" Value="3" 
                                           TickFrequency="1" IsSnapToTickEnabled="True"
                                           ValueChanged="MaxRetriesSlider_ValueChanged"/>
                                    <TextBlock Name="MaxRetriesLabel" 
                                              Grid.Column="1"
                                              Text="3" 
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"/>
                                </Grid>
                                <TextBlock Text="遇到網路錯誤時的重試次數" 
                                          Style="{StaticResource MaterialDesignCaptionTextBlock}"
                                          Foreground="Gray" Margin="0,5,0,0"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- 進階設定 -->
                        <materialDesign:Card Margin="0,0,0,20" Padding="20">
                            <StackPanel>
                                <TextBlock Text="進階設定" 
                                          Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                          Margin="0,0,0,15"/>
                                
                                <CheckBox Name="EnableQueryMetadataCheckBox" 
                                         Content="啟用 query_metadata（增強 AI 查詢上下文）"
                                         Margin="0,0,0,10"/>
                                
                                <TextBlock Text="知識庫 ID：" Margin="0,0,0,5"/>
                                <TextBox Name="KnowledgeBaseIdTextBox"
                                        materialDesign:HintAssist.Hint="指定特定的知識庫進行查詢（可選）"
                                        Margin="0,0,0,10"/>
                                
                                <TextBlock Text="標籤 ID：" Margin="0,0,0,5"/>
                                <TextBox Name="LabelIdTextBox"
                                        materialDesign:HintAssist.Hint="使用特定標籤過濾查詢結果（可選）"
                                        Margin="0,0,0,10"/>
                                
                                <CheckBox Name="EnableContextCombinationCheckBox" 
                                         Content="啟用上下文組合（維持對話連續性）"
                                         IsChecked="True"
                                         Margin="0,0,0,10"/>
                            </StackPanel>
                        </materialDesign:Card>

                        <!-- 操作按鈕 -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <Button Name="LoadConfigButton" 
                                   Content="載入設定" 
                                   Click="LoadConfigButton_Click"
                                   Style="{StaticResource MaterialDesignOutlinedButton}"
                                   Margin="0,0,10,0"/>
                            <Button Name="SaveConfigButton" 
                                   Content="儲存設定" 
                                   Click="SaveConfigButton_Click"
                                   Style="{StaticResource MaterialDesignRaisedButton}"
                                   Margin="0,0,10,0"/>
                            <Button Name="AboutButton" 
                                   Content="關於程式" 
                                   Click="AboutButton_Click"
                                   Style="{StaticResource MaterialDesignOutlinedButton}"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 驗證頁面 -->
            <TabItem Header="🔍 驗證">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 文件選擇 -->
                    <materialDesign:Card Grid.Row="0" Margin="0,0,0,20" Padding="20">
                        <StackPanel>
                            <TextBlock Text="測試文件選擇" 
                                      Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                      Margin="0,0,0,15"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBox Name="CsvFilePathTextBox" 
                                        Grid.Column="0"
                                        IsReadOnly="True"
                                        materialDesign:HintAssist.Hint="選擇 CSV 或 Excel 測試文件"
                                        Margin="0,0,10,0"/>
                                <Button Name="BrowseFileButton" 
                                       Grid.Column="1"
                                       Content="瀏覽" 
                                       Click="BrowseFileButton_Click"
                                       Style="{StaticResource MaterialDesignOutlinedButton}"
                                       Margin="0,0,10,0"/>
                                <Button Name="RetryFailedButton" 
                                       Grid.Column="2"
                                       Content="重測失敗問題" 
                                       Click="RetryFailedButton_Click"
                                       Style="{StaticResource MaterialDesignOutlinedButton}"/>
                            </Grid>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- 聊天機器人選擇 -->
                    <materialDesign:Card Grid.Row="1" Margin="0,0,0,20" Padding="20">
                        <StackPanel>
                            <TextBlock Text="聊天機器人選擇" 
                                      Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                      Margin="0,0,0,15"/>
                            
                            <ListBox Name="ChatbotListBox" 
                                    Height="120"
                                    SelectionMode="Single"/>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- 驗證控制 -->
                    <materialDesign:Card Grid.Row="2" Margin="0,0,0,20" Padding="20">
                        <StackPanel>
                            <TextBlock Text="驗證控制" 
                                      Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                      Margin="0,0,0,15"/>
                            
                            <StackPanel Orientation="Horizontal">
                                <Button Name="StartValidationButton" 
                                       Content="開始驗證" 
                                       Click="StartValidationButton_Click"
                                       Style="{StaticResource MaterialDesignRaisedButton}"
                                       Margin="0,0,10,0"/>
                                <Button Name="StopValidationButton" 
                                       Content="停止驗證" 
                                       Click="StopValidationButton_Click"
                                       Style="{StaticResource MaterialDesignOutlinedButton}"
                                       IsEnabled="False"/>
                            </StackPanel>

                            <!-- 進度條 -->
                            <TextBlock Name="ProgressLabel" 
                                      Text="就緒" 
                                      Margin="0,15,0,5"/>
                            <ProgressBar Name="ValidationProgressBar" 
                                        Height="6" 
                                        Value="0"/>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- 日誌顯示 -->
                    <materialDesign:Card Grid.Row="3" Padding="20">
                        <StackPanel>
                            <TextBlock Text="驗證日誌" 
                                      Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                      Margin="0,0,0,15"/>
                            
                            <ScrollViewer Height="300" VerticalScrollBarVisibility="Auto">
                                <TextBox Name="LogTextBox" 
                                        IsReadOnly="True"
                                        TextWrapping="Wrap"
                                        VerticalAlignment="Stretch"
                                        AcceptsReturn="True"
                                        Background="Transparent"
                                        BorderThickness="0"/>
                            </ScrollViewer>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- 操作按鈕 -->
                    <StackPanel Grid.Row="4" 
                               Orientation="Horizontal" 
                               HorizontalAlignment="Right" 
                               Margin="0,20,0,0">
                        <Button Name="ClearLogButton" 
                               Content="清空日誌" 
                               Click="ClearLogButton_Click"
                               Style="{StaticResource MaterialDesignOutlinedButton}"
                               Margin="0,0,10,0"/>
                        <Button Name="ExportLogButton" 
                               Content="匯出日誌" 
                               Click="ExportLogButton_Click"
                               Style="{StaticResource MaterialDesignOutlinedButton}"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- 結果頁面 -->
            <TabItem Header="📊 結果">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 統計摘要 -->
                    <materialDesign:Card Grid.Row="0" Margin="0,0,0,20" Padding="20">
                        <StackPanel Name="StatsSummaryPanel">
                            <TextBlock Text="驗證統計摘要" 
                                      Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                      Margin="0,0,0,15"/>
                            
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                                    <TextBlock Text="總查詢數" Style="{StaticResource MaterialDesignCaptionTextBlock}"/>
                                    <TextBlock Name="TotalQueriesLabel" Text="0" Style="{StaticResource MaterialDesignHeadline4TextBlock}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="1" Margin="0,0,10,0">
                                    <TextBlock Text="成功率" Style="{StaticResource MaterialDesignCaptionTextBlock}"/>
                                    <TextBlock Name="SuccessRateLabel" Text="0%" Style="{StaticResource MaterialDesignHeadline4TextBlock}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="2" Margin="0,0,10,0">
                                    <TextBlock Text="平均 F1-Score" Style="{StaticResource MaterialDesignCaptionTextBlock}"/>
                                    <TextBlock Name="AverageF1Label" Text="0.00" Style="{StaticResource MaterialDesignHeadline4TextBlock}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Column="3">
                                    <TextBlock Text="命中率" Style="{StaticResource MaterialDesignCaptionTextBlock}"/>
                                    <TextBlock Name="HitRateLabel" Text="0%" Style="{StaticResource MaterialDesignHeadline4TextBlock}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- 結果數據表格 -->
                    <materialDesign:Card Grid.Row="1" Padding="20">
                        <StackPanel>
                            <TextBlock Text="詳細結果" 
                                      Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                      Margin="0,0,0,15"/>
                            
                            <DataGrid Name="ResultsDataGrid" 
                                     AutoGenerateColumns="False"
                                     CanUserAddRows="False"
                                     IsReadOnly="True">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="編號" Binding="{Binding 編號}" Width="80"/>
                                    <DataGridTextColumn Header="提問者" Binding="{Binding 提問者}" Width="100"/>
                                    <DataGridTextColumn Header="問題描述" Binding="{Binding 問題描述}" Width="200"/>
                                    <DataGridTextColumn Header="驗證狀態" Binding="{Binding 驗證狀態}" Width="100"/>
                                    <DataGridTextColumn Header="Precision" Binding="{Binding Precision, StringFormat=F3}" Width="80"/>
                                    <DataGridTextColumn Header="Recall" Binding="{Binding Recall, StringFormat=F3}" Width="80"/>
                                    <DataGridTextColumn Header="F1-Score" Binding="{Binding F1Score, StringFormat=F3}" Width="80"/>
                                    <DataGridTextColumn Header="Hit Rate" Binding="{Binding HitRate, StringFormat=F3}" Width="80"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- 匯出按鈕 -->
                    <StackPanel Grid.Row="2" 
                               Orientation="Horizontal" 
                               HorizontalAlignment="Right" 
                               Margin="0,20,0,0">
                        <Button Name="ExportResultsButton" 
                               Content="匯出結果" 
                               Click="ExportResultsButton_Click"
                               Style="{StaticResource MaterialDesignRaisedButton}"
                               Margin="0,0,10,0"/>
                        <Button Name="OpenResultsFolderButton" 
                               Content="開啟結果資料夾" 
                               Click="OpenResultsFolderButton_Click"
                               Style="{StaticResource MaterialDesignOutlinedButton}"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- 組織管理頁面 -->
            <TabItem Header="👥 組織管理">
                <TabControl Margin="10">
                    <!-- 組織匯出 -->
                    <TabItem Header="📤 組織匯出">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="20">
                                <!-- API 設定 -->
                                <materialDesign:Card Margin="0,0,0,20" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="API 設定" 
                                                  Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                                  Margin="0,0,0,15"/>
                                        
                                        <TextBlock Text="API 基礎 URL：" Margin="0,0,0,5"/>
                                        <TextBox Name="OrgExportApiUrlTextBox" 
                                                materialDesign:HintAssist.Hint="組織管理 API 基礎 URL"
                                                Margin="0,0,0,15"/>
                                        
                                        <TextBlock Text="API 金鑰：" Margin="0,0,0,5"/>
                                        <PasswordBox Name="OrgExportApiKeyPasswordBox"
                                                   materialDesign:HintAssist.Hint="組織管理 API 金鑰"
                                                   Margin="0,0,0,15"/>
                                        
                                        <Button Name="TestOrgConnectionButton" 
                                               Content="測試連接" 
                                               Click="TestOrgConnectionButton_Click"
                                               Style="{StaticResource MaterialDesignRaisedButton}"
                                               HorizontalAlignment="Left"/>
                                    </StackPanel>
                                </materialDesign:Card>

                                <!-- 組織選擇 -->
                                <materialDesign:Card Margin="0,0,0,20" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="組織選擇" 
                                                  Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                                  Margin="0,0,0,15"/>
                                        
                                        <ListBox Name="OrganizationListBox" 
                                                Height="150"
                                                SelectionMode="Single"
                                                Margin="0,0,0,15"/>
                                        
                                        <Button Name="LoadOrganizationsButton" 
                                               Content="載入組織列表" 
                                               Click="LoadOrganizationsButton_Click"
                                               Style="{StaticResource MaterialDesignOutlinedButton}"
                                               HorizontalAlignment="Left"/>
                                    </StackPanel>
                                </materialDesign:Card>

                                <!-- 匯出控制 -->
                                <materialDesign:Card Margin="0,0,0,20" Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="匯出控制" 
                                                  Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                                  Margin="0,0,0,15"/>
                                        
                                        <Button Name="StartExportButton" 
                                               Content="開始匯出" 
                                               Click="StartExportButton_Click"
                                               Style="{StaticResource MaterialDesignRaisedButton}"
                                               HorizontalAlignment="Left"/>
                                    </StackPanel>
                                </materialDesign:Card>

                                <!-- 匯出日誌 -->
                                <materialDesign:Card Padding="20">
                                    <StackPanel>
                                        <TextBlock Text="匯出日誌" 
                                                  Style="{StaticResource MaterialDesignHeadline6TextBlock}"
                                                  Margin="0,0,0,15"/>
                                        
                                        <ScrollViewer Height="200" VerticalScrollBarVisibility="Auto">
                                            <TextBox Name="ExportLogTextBox" 
                                                    IsReadOnly="True"
                                                    TextWrapping="Wrap"
                                                    AcceptsReturn="True"
                                                    Background="Transparent"
                                                    BorderThickness="0"/>
                                        </ScrollViewer>
                                    </StackPanel>
                                </materialDesign:Card>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- 其他組織管理功能可以在這裡添加 -->
                    <TabItem Header="📥 批量匯入">
                        <TextBlock Text="批量匯入功能開發中..." 
                                  HorizontalAlignment="Center" 
                                  VerticalAlignment="Center"/>
                    </TabItem>

                    <TabItem Header="🗃️ 知識庫管理">
                        <TextBlock Text="知識庫管理功能開發中..." 
                                  HorizontalAlignment="Center" 
                                  VerticalAlignment="Center"/>
                    </TabItem>
                </TabControl>
            </TabItem>
        </TabControl>
    </Grid>
</Window> 